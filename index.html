<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This is a blog about programming and making life easier">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Programming</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://pleasenophp.github.io/index.html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/prune-folder.html" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://pleasenophp.github.io/">

                <span id="blog-title">Programming</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/prune-folder.html" class="u-url">Prune folder</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Innerbytes
            </span></p>
            <p class="dateline"><a href="posts/prune-folder.html" rel="bookmark"><time class="published dt-published" datetime="2016-11-17T10:24:38+01:00" title="2016-11-17 10:24">2016-11-17 10:24</time></a></p>
                <p class="commentline">
        
    <a href="posts/prune-folder.html#disqus_thread" data-disqus-identifier="cache/posts/prune-folder.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<h3>Prune / clear folder with a strategy</h3>
<p>Sometimes there is a typical task: automated builds are copied to a folder every hour. We need to schedule a task to remove extra files from time to time.
But it's still good to do it with custom strategy. It can be simple: if file is older then N days, then keep only one last file per day, and if file is older than M days where M &gt; N, then keep only one last file per month.
I didn't find any similar script in the internet, so made one myself. It can be modified to achieve slightly different strategies when needed.</p>
<p>This scripts works if all the files or folders named following the format: </p>
<pre class="code literal-block"><span></span>text1-yyyy-mm-dd-text2
</pre>


<p>where <em>text1</em> and <em>text2</em> can be anything not starting with digits, and <em>text1</em> is the same for all the files in the folder. The <em>yyyy-mm-dd</em> is the build date in the file name. The date must be the part of the file name, 
because sorting by date of creation is dangerous - it's easy to change the date by doing something with files on the server. </p>
<p>Read the beginning of the script for the usage example: <a href="https://github.com/pleasenophp/scripts/blob/master/prune.sh">prune.sh</a></p>
<p>Note, that you also need to install <strong>ruby</strong> for this script to work, because it was more convenient to use ruby for the cross-platform date calculations.  </p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/lets-talk-about-big-d.html" class="u-url">Let's talk about big D</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Innerbytes
            </span></p>
            <p class="dateline"><a href="posts/lets-talk-about-big-d.html" rel="bookmark"><time class="published dt-published" datetime="2016-11-15T22:14:54+01:00" title="2016-11-15 22:14">2016-11-15 22:14</time></a></p>
                <p class="commentline">
        
    <a href="posts/lets-talk-about-big-d.html#disqus_thread" data-disqus-identifier="cache/posts/lets-talk-about-big-d.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I would like to start a serie of posts about the context-oriented dependency injection and IoC in C#. This is related to my IoC container framework called <strong>MinDI</strong>. Before introducing MinDI and talking about usage and implementation, let's take briefly theoretical and philosophycal aspects of it. </p>
<h3>Coupling</h3>
<p>I suppose you are familiar with the <a href="http://goo.gl/9b6xB6">SOLID</a> principles. If not yet, go now and read, and apply it in your programming life, and then come back. SOLID is a must have for any OO design. </p>
<p>So if you are still here, I guess you also have at least heard about <a href="http://www.codeproject.com/Articles/615139/An-Absolute-Beginners-Tutorial-on-Dependency-Inver">IoC containers</a>. The IoC container provides generally a nice way to resolve the big D problem of SOLID, and its good implementation encourages and makes it easier to apply all the other biggies as well :) Here and in the next posts we will talk about some aspects of Dependency Inversion and Injection, and about IoC containers, and Context-oriented programming and more.</p>
<p>So, to begin, the largest problem that arises in a more or less complex project, is dependencies and coupling. Generally we should try to minimize the both between modules as much as possible. </p>
<p>The tight coupling means that class A directly knows class B. This doesn't allow the class A to be tested independently of class B, nor it allows to mock class B, and also if we need a different implementation of class B, we cannot easily substitute it. That also violates big O principle for class A, as it will require changes during the project lifetime. That's why big D says, that entities should not depend on each other, but on abstractions. Such abstraction in C# is called <em>interface</em>. Let's see a few examples of coupling:</p>
<p><strong>a.</strong> Tight coupling where class A directly knows class B:</p>
<pre class="code literal-block"><span></span>    <span class="k">class</span> <span class="nc">B</span> <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
        <span class="n">B</span> <span class="n">b</span><span class="p">;</span>
        <span class="k">void</span> <span class="nf">Action</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">doSomethingWith</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre>


<p>As described above, this structure creates major problem and violates SOLID. Any medium and large projects, that are using tight coupling, become insupportable quite fast.</p>
<p><strong>b.</strong> Another example of very bad using of tight coupling is Singletone anti-pattern.</p>
<pre class="code literal-block"><span></span><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">void</span> <span class="nf">Action</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">B</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">DoSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>


<p>This is terrible, because in such code many classes start to use singletons inside of the obscured calls, then singletons use other singletons, then everything is tight coupled and explodes when you need to change something. Unfortunately such a bad code can be encountered quite often, especially in the game development, where <del>programmers usually suck</del> the quaility of the code can be rather low. </p>
<h3>Setting it free</h3>
<p>I briefly tocuhed tight coupling, because it's not very interesting, you can find plenty information about it in the internet. And the solution to the mentioned problem can be formulated in simple statements:</p>
<ul>
<li>Make all your code depend only on abstractions (in C# it's interfaces), what's called <em>loose coupling</em>
</li>
<li>Make a separate code that configures the abstractions, by matching them with concrete implementations</li>
</ul>
<p>That gives us the following main advantages:</p>
<ul>
<li>Concrete implementations of entities can be replaced separately only in one place, without changing the rest of the code. Our code becomes refactoring friendly.</li>
<li>TDD-friendly too. Now it's very easy to mock separate interfaces, so the entities become very testable individually. </li>
<li>The modularity of the code is increased, and the usage of big L, big S, and big I is especially encouraged. We don't need to create big God classes anymore, as we can easily define the concrete dependencies for each entity.
We can easily susbtitute the concrete implementations of the interfaces, keeping all the rest of the code without any knowledge of the fact, that we changed anything, as everything depends on interfaces, not on implementations. Of course, using of IoC/DI patterns cannot guarantee you will start magically write a good code, but it rather opens all the roads to write a nice code, if you understand what you are doing.  </li>
<li>The dependencies become strictly defined in each concrete implementatons (we will talk about the Dependency Contract later), and not spread implicitly through the code.</li>
</ul>
<p>As you can see, it's all about Agile development, where we need to make the code, that is equally responsible to new feature requests in the whole lifetime of the project. Where we also want to use TDD to increase the stability of our builds. And where we want to have some fun by making code that looks nice and makes us happy. </p>
<h3>We need a framework</h3>
<p>Using DI and coding to interface approach also opens some questions:</p>
<ul>
<li>if we start depending only on interfaces, what is a good way of easily passing those dependencies to concrete entities?</li>
<li>if we avoid using singleton patterns, what is a good way to have several entity use the same instance? How do we control lifetime of the objects?</li>
<li>how can we organize a centralized place of defining the concrete implementations for each interface?</li>
<li>can those implementations be substituted dynamically during runtime as well?</li>
<li>can different parts of the code use different concrete implementatons of the same abstractions they depend on?</li>
</ul>
<p>The IoC/DI framework is designed to solve all those problems. Without such a framework we would need to just pass dependencies manually to every created instance everywhere, and that would be very painfull. So without a framework or support from the language part, the DI pattern and coding to interface approach remain good only on the paper. </p>
<p>C# is an interface-based language, and should encourage people to use interfaces. If you look at the .NET API itself, they have interfaces for everything. But how many code did you usually encounter in C#, that uses interfaces as a base? That's because Microsoft didn't force to use DI in .NET, leaving the choice of DI, or another pattern to developer. You can use Spring.NET, Unity, or other popular DI libraries. But how many C# programmers ever heard about DI? In the game development, where I worked during 6 years, the most of the C# code I've seen was ugly enough. The better situation is in Java world, where there are more traditions on coding standards. But you have to chose the DI library in Java as well, and the choice sometimes is not easy, because most of the modern libraries are not context-oriented, lack some features, or little refactoring-friendly. While there should still be a choice, I believe, the built in DI/IoC should be part of any modern strongly-typed language. I think people should learn SOLID, DRY and DI principles right together with learning OOP at school. But our world sucks. This was a little complaining part. Now it's time to change the situation, and start using advantages of dependency injection if you don't use it yet.</p>
<h3>A few words about Service Locator pattern</h3>
<p>It's ugly. Was that enough words?</p>
<ul>
<li>Instead of removing tight coupling, it creates a new tight coupling, where all the classes are singleton-like coupled to service locator itself. </li>
<li>It doesn't allow Dependency Contract, not allowing to make the dependencies explicit. That is a major advantage of DI, and we talk later about it. </li>
<li>It doesn't allow for any easy implementation of context-oriented and layered dependencies (I will reveal more on this topic later).  </li>
</ul>
<p>So basically, service locator is improved version of a singleton, that still smells. </p>
<p>I hope I have encouraged you to at least research information about DI/IoC containers, and maybe try some of them. The next articles will start telling about <strong>MinDI</strong> framework and will show some usage examples.  </p>
<!--
#### Next:

Principles:
- Abstractions are open for dependent classes, but the implementatons are closed
- Context is an abstract factory that resolves abstractions to concrete classes by the name and types
- Context is populated in the application start point, and at the objects building point, and in no other place in the program should the concrete entities be referenced in any way.
- The entity can depend only on the abstractions, that explicitly specified in the contract 
- The entities have no open access to context, or to the concrete implementations,  except entities of creational patterns (factories, builders)
- Any dynamic dependencies should not be resolved implicitly, but should use contracts (factory interfaces)

3 level of the access:
- Full access for context
- Context access for creation patterns
- Abstractions access for the rest of the code

3 main Layers
- Global for library dependencies 
- Application for redefining library dependencies, and defining application dependencies
- Factory, for defining dependencies of dynamically created objects (with lifetime less than application)

Prototype principle of the dependencies.



- Introducing IoC container
- Problems that IoC containers have
    * Access container itself
    * Unrestricted access to all the interfaces
    * Handling complex data structures
    * Refactoring friendly

#### Next articles:

#### Introducing context as IoC container
    (abstract, concrete, layers, closed context, factories, property injection)
    Generics example
    How do we think example, in context

#### Usage of MinDI articles
(simple HW, Unity application, generics application, factory context, constructions, etc)
-->
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/conque-vim-powered-command-line.html" class="u-url">Conque: vim-powered command line</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Innerbytes
            </span></p>
            <p class="dateline"><a href="posts/conque-vim-powered-command-line.html" rel="bookmark"><time class="published dt-published" datetime="2016-11-07T21:06:29+01:00" title="2016-11-07 21:06">2016-11-07 21:06</time></a></p>
                <p class="commentline">
        
    <a href="posts/conque-vim-powered-command-line.html#disqus_thread" data-disqus-identifier="cache/posts/conque-vim-powered-command-line.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I'm doing most actions in the command line. Recently I enabled vim mode in bash, which helped me to easily navigate in the command I'm typing. However, I was quite frustrated that whenever I need to select something from the console output, I need to use mouse. I would like to be able to use Vim for selecting the previous text in the console and pasting it into the command. And here Conque comes to help! It's a plugin that allows to run shell inside of vim, with full output into the current buffer.</p>
<p>Install it from <a href="https://code.google.com/archive/p/conque/downloads">here</a>.</p>
<p>After it, run vim, and you can test it works with the following command:</p>
<pre class="code literal-block"><span></span><span class="p">:</span>ConqueTerm bash
</pre>


<p>But of course we can improve it a little with a script. Add the following to the .bash_profile:</p>
<pre class="code literal-block"><span></span><span class="nb">alias</span> <span class="nv">vimc</span><span class="o">=</span><span class="s1">'vim -c "ConqueTerm bash" -c "set nu"'</span>
</pre>


<p>This will enable the <strong>vimc</strong> alias that will just start vim in conque mode, and will also enable the line numbers (even if you put <strong>set nu</strong> into your .vimrc, Conque ignores it for some reason).</p>
<p>As I'm on Mac, I also had to create a symlink to my .bash_profile, as Conque reads .bashrc by default.
Run this from the home folder:</p>
<pre class="code literal-block"><span></span>$ ln -s .bash_profile .bashrc
</pre>


<p>Also you might notice that Conque doesn't display the system user and folder name in the command line. For this just do the following trick (while still in the regular console):</p>
<pre class="code literal-block"><span></span>$ <span class="nb">echo</span> <span class="s2">"export PS1='</span><span class="nv">$PS1</span><span class="s2">'"</span> &gt;&gt; ~/.bash_profile
</pre>


<p>This will add your regular settings of the shell prompt to the bash initialization script, and Conque will read it.</p>
<p>Voilà! Now just run:</p>
<pre class="code literal-block"><span></span>$ vimc
</pre>


<p>And you can have a lot of fun with command line and your favorite vim! Just better don't try to run vim inside vim, looks a bit ugly :-P
<img alt="OMG" src="images/vim-in-vim.jpg" title="WTF??"></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/i-have-installed-nikola.html" class="u-url">I have installed Nikola</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Innerbytes
            </span></p>
            <p class="dateline"><a href="posts/i-have-installed-nikola.html" rel="bookmark"><time class="published dt-published" datetime="2016-11-06T08:42:39+01:00" title="2016-11-06 08:42">2016-11-06 08:42</time></a></p>
                <p class="commentline">
        
    <a href="posts/i-have-installed-nikola.html#disqus_thread" data-disqus-identifier="cache/posts/i-have-installed-nikola.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<h3>I'm happy</h3>
<p>I can now write all my blog posts in vim, using markdown, without distracting from the command line.
<a href="https://getnikola.com">Nikola</a> rules! It allows you to store blog locally, commit it under git, and generate static html whenever you wish to deploy. You can use your favorite web hosting or github pages to host the blog. 
<del>The only thing that frustrates me so far is the default styles of the code blocks, I wanna black background as in the terminal.</del>
It appeared Nikola supports many code themes just in the configuration file! So I have set a good black one called "monokai" to start with (might change it later).</p>
<pre class="code literal-block"><span></span><span class="n">CODE_COLOR_SCHEME</span> <span class="o">=</span> <span class="s1">'monokai'</span>
</pre>


<p>in the <em>conf.py</em></p>
<p>And my old blog on Blogger is still <a href="https://pleasenophp.blogspot.dk">here</a>. There is only a few posts.</p>
<hr>
<p>For those who already installed Nikola, there might be helpfull some scripts. I have added this to my .bash_profile:</p>
<pre class="code literal-block"><span></span><span class="nb">alias</span> <span class="nv">nstart</span><span class="o">=</span><span class="s2">"cd ~/nikola &amp;&amp; source bin/activate &amp;&amp; source .rc"</span>
</pre>


<p>This will enable nstart alias that automatically opens your nikola path, and activates the virtual environment. Then it reads my .rc file that I put under nikola folder:</p>
<pre class="code literal-block"><span></span><span class="nb">eval</span> <span class="s2">"`nikola tabcompletion`"</span>

<span class="nb">alias</span> <span class="nv">nnew</span><span class="o">=</span><span class="s2">"nikola new_post -f markdown"</span>
<span class="nb">alias</span> <span class="nv">nbuild</span><span class="o">=</span><span class="s2">"nikola build"</span>
<span class="nb">alias</span> <span class="nv">nserve</span><span class="o">=</span><span class="s2">"nikola serve -b"</span>
<span class="nb">alias</span> <span class="nv">ndeploy</span><span class="o">=</span><span class="s2">"nikola github_deploy"</span>

<span class="nb">alias</span> <span class="nv">nstop</span><span class="o">=</span><span class="s2">"deactivate &amp;&amp; cd ~"</span>
</pre>


<p>It adds some handy short aliases for build, serve and deploy, and the first line also enables the tabcompletion.
When I finish working in the Nikola virtual environment I type nstop.</p>
<p>And ofc you should enable markdown in Nikola, because by default is uses somethin else <em>(maybe what it uses is better, I didn't check, but I didn't either feel like learning one more not so popular markup standard).</em></p>
<p>To enable markdown, just add .md extension in POSTS and PAGES in <em>conf.py</em> like this:</p>
<pre class="code literal-block"><span></span><span class="n">POSTS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">"posts/*.rst"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.txt"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.html"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"posts/*.md"</span><span class="p">,</span> <span class="s2">"posts"</span><span class="p">,</span> <span class="s2">"post.tmpl"</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">PAGES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">"pages/*.rst"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.txt"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.html"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"pages/*.md"</span><span class="p">,</span> <span class="s2">"pages"</span><span class="p">,</span> <span class="s2">"story.tmpl"</span><span class="p">)</span>
<span class="p">)</span>
</pre>
</div>
    </div>
    </article>
</div>



        
       <script>var disqus_shortname="pleasenophp";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:info@innerbytes.com">Innerbytes</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
